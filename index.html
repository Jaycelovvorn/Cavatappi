<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>16-bit Adder/Subtractor — GitHub Pages</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin: 24px; }
    input[type=number] { width: 140px; }
    .row { margin-bottom: 12px; }
    pre { background:#f8f8f8; padding:12px; border:1px solid #ddd; overflow:auto; max-height:320px; }
    .cards { display:flex; gap:16px; align-items:flex-start; }
    .card { flex:1; min-width:260px; }
    .flags { font-family: monospace; }
    label { margin-right:8px; }
    .small { font-size: 0.9rem; color:#555 }
  </style>
</head>
<body>
  <h1>16-bit Adder / Subtractor (Gate-level simulation in browser)</h1>

  <div class="row">
    <label>A (0-65535): <input id="A" type="number" min="0" max="65535" value="5"></label>
    <label>B (0-65535): <input id="B" type="number" min="0" max="65535" value="3"></label>
    <label>SUB: <select id="SUB"><option value="0">Add (0)</option><option value="1">Sub (1)</option></select></label>
    <button id="compute">Compute</button>
  </div>

  <div class="cards">
    <div class="card">
      <h3>Result</h3>
      <div id="resultDisplay" class="small">—</div>
      <div class="flags" id="flags"></div>
      <h4>Binary</h4>
      <pre id="binary"></pre>
    </div>

    <div class="card">
      <h3>VHDL Sources (fetched from repo)</h3>
      <h4>adder_subtractor_16.vhd</h4>
      <pre id="vhdl1">Loading…</pre>
      <h4>tb_adder_subtractor_16.vhd</h4>
      <pre id="vhdl2">Loading…</pre>
    </div>
  </div>

  <script>
    // Gate-level 16-bit add/sub implemented in JS bit-by-bit
    function add_sub_16(a, b, sub) {
      const mask = 0xFFFF;
      a = a & mask; b = b & mask;
      // conditional invert of B
      const bx = b ^ (sub ? mask : 0);

      let result = 0;
      let carry = sub ? 1 : 0; // initial carry-in = SUB

      // compute bit-by-bit
      for (let i = 0; i < 16; ++i) {
        const ai = (a >> i) & 1;
        const bi = (bx >> i) & 1;
        const s = ai ^ bi ^ carry; // sum bit
        result |= (s << i);
        const cout = (ai & bi) | (bi & carry) | (ai & carry);
        carry = cout;
      }

      const carryOut = carry & 1;

      // compute carry into MSB for overflow detection
      carry = sub ? 1 : 0;
      for (let i = 0; i < 15; ++i) {
        const ai = (a >> i) & 1;
        const bi = (bx >> i) & 1;
        const cout = (ai & bi) | (bi & carry) | (ai & carry);
        carry = cout;
      }
      const carryIntoMSB = carry & 1;
      const overflow = (carryIntoMSB ^ carryOut) & 1;
      const zero = ((result & mask) === 0) ? 1 : 0;
      const signed = (result & 0x8000) ? result - 0x10000 : result;

      return {
        A: a, B: b, SUB: sub,
        Result: result & mask, Result_signed: signed,
        CarryOut: carryOut, Overflow: overflow, Zero: zero,
        hex: '0x' + ((result & mask).toString(16).toUpperCase().padStart(4,'0'))
      };
    }

    function toBin16(x) {
      return (x & 0xFFFF).toString(2).padStart(16,'0').replace(/(.{4})/g,'$1 ').trim();
    }

    async function fetchVHDL(id, path) {
      try {
        const r = await fetch(path);
        if (!r.ok) throw new Error(r.statusText);
        const txt = await r.text();
        document.getElementById(id).textContent = txt;
      } catch (e) {
        document.getElementById(id).textContent = path + ' not found or fetch failed: ' + e.message;
      }
    }

    document.getElementById('compute').addEventListener('click', () => {
      const A = parseInt(document.getElementById('A').value || '0', 10);
      const B = parseInt(document.getElementById('B').value || '0', 10);
      const SUB = parseInt(document.getElementById('SUB').value || '0', 10);
      const res = add_sub_16(A, B, SUB);
      document.getElementById('resultDisplay').textContent = `Result = ${res.Result} (signed = ${res.Result_signed}) HEX=${res.hex}`;
      document.getElementById('flags').textContent = `CarryOut=${res.CarryOut}  Overflow=${res.Overflow}  Zero=${res.Zero}`;
      document.getElementById('binary').textContent = toBin16(res.Result);
    });

    // initial compute
    document.getElementById('compute').click();

    // fetch VHDL files from repo root — GitHub Pages will serve these files when in repo root
    fetchVHDL('vhdl1','/adder_subtractor_16.vhd');
    fetchVHDL('vhdl2','/tb_adder_subtractor_16.vhd');
  </script>
</body>
</html>
